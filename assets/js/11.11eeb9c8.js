(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{566:function(t,s,a){"use strict";a.r(s);var n=a(14),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"jvm配置参数-x与-xx的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jvm配置参数-x与-xx的区别"}},[t._v("#")]),t._v(" JVM配置参数-X与-XX的区别")]),t._v(" "),a("p",[t._v("启动JVM时通过指定配置参数来指导虚拟机按照我们的要求提供服务，这一点对大多数的Java程序员来说已经是司空见惯。")]),t._v(" "),a("p",[t._v("在指定配置参数时，会"),a("strong",[t._v("有-X和-XX两种形式")]),t._v("，那么它们两者有什么区别呢，今天我想借这篇文章总结一下。")]),t._v(" "),a("p",[t._v("下面是我们的某个Java项目在正式环境上启动JVM时的一个典型命令，在该命令中指定了各种启动参数：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("java "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Xmx15G")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Xms10G")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Xmn3G")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Xss512k")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MaxPermSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v("M \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PermSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v("M \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintFlagsFinal")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MaxTenuringThreshold")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SurvivorRatio")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TargetSurvivorRatio")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Xnoclassgc")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UseParNewGC")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UseConcMarkSweepGC")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CMSInitiatingOccupancyFraction")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ParallelGCThreads")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConcGCThreads")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CMSParallelRemarkEnabled")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CMSScavengeBeforeRemark")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExplicitGCInvokesConcurrent")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UseTLAB")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TLABSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("K"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("verbose"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("gc \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintGCDetails")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintGCDateStamps")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintGCTimeStamps")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintGCApplicationStoppedTime")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Xloggc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("/gc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log\n")])])]),a("p",[t._v("Java HotSpot VM的官方文档中将启动参数分为如下两类：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[t._v("配置参数")])]),t._v(" "),a("th",[a("strong",[t._v("类型")])]),t._v(" "),a("th",[a("strong",[t._v("说明")])]),t._v(" "),a("th",[a("strong",[t._v("举例")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("-X")]),t._v(" "),a("td",[t._v("non-standard")]),t._v(" "),a("td",[a("strong",[t._v("非标准参数。")]),t._v("<br/><br/>这些参数不是虚拟机规范规定的。因此，不是所有VM的实现(如:HotSpot,JRockit,J9等)都支持这些配置参数。")]),t._v(" "),a("td",[t._v("-Xmx、-Xms、-Xmn、-Xss")])]),t._v(" "),a("tr",[a("td",[t._v("-XX")]),t._v(" "),a("td",[t._v("not-stable")]),t._v(" "),a("td",[a("strong",[t._v("不稳定参数。")]),t._v("<br/><br/>这些参数是虚拟机规范中规定的。这些参数指定虚拟机实例在运行时的各种行为，从而对虚拟机的运行时性能有很大影响。")]),t._v(" "),a("td",[t._v("-XX:SurvivorRatio、-XX:+UseParNewGc")])])])]),t._v(" "),a("p",[t._v("补充: -X和-XX两种参数都可能随着JDK版本的变更而发生变化，有些参数可以能会被废弃掉，有些参数的功能会发生改变，但是JDK官方不会通知开发者这些变化，需要使用者注意。")]),t._v(" "),a("p",[t._v("-XX参数被称为不稳定参数，是因为这类参数的设置会引起JVM运行时性能上的差异，配置得当可以提高JVM性能，配置不当则会使JVM出现各种问题, 甚至造成JVM崩溃。")]),t._v(" "),a("p",[t._v("国外有个哥们从HotSpot VM的源码里发现了934个此类型的配置参数，因此能对JVM做出很多组合配置，对JVM的调优也没有统一的标准，需要我们在实践中不断总结经验，并结合实际业务来进行操作，最终找到最适合当前业务的那些配置。")]),t._v(" "),a("h3",{attrs:{id:"一些有用的-xx配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一些有用的-xx配置"}},[t._v("#")]),t._v(" 一些有用的-XX配置")]),t._v(" "),a("p",[t._v("对于-XX类型的配置选项，虚拟机规范有一些惯例，针对不同的平台虚拟机也会提供不同的默认值。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("对于布尔(Boolean)类型的配置选项，通过-XX:+<option>来开启，通过-XX:-<option>来关闭。")])]),t._v(" "),a("li",[a("p",[t._v("对于数字(Numberic)类型的配置选项，通过-XX:<option>=<number>来配置。<number>后面可以携带单位字母，比如: 'k'或者'K'代表千字节，'m'或者'M'代表兆字节，'g'或者'G'代表千兆字节。")])]),t._v(" "),a("li",[a("p",[t._v("对于字符串(String)类型的配置选项，通过-XX:<option>=<string>来配置。这种配置通过用来指定文件，路径或者命令列表。")])])]),t._v(" "),a("h3",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("p",[t._v("<http://www.nituchao.com/jvm-tuning/8.html>")]),t._v(" "),a("h2",{attrs:{id:"java-x命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java-x命令"}},[t._v("#")]),t._v(" java -X命令")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("wale"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("java -X\n    -Xmixed           混合模式执行（默认）\n    -Xint             仅解释模式执行\n    -Xbootclasspath:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("用 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" 分隔的目录和 zip/jar 文件"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                      设置引导类和资源的搜索路径\n    -Xbootclasspath/a:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("用 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" 分隔的目录和 zip/jar 文件"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                      附加在引导类路径末尾\n    -Xbootclasspath/p:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("用 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" 分隔的目录和 zip/jar 文件"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                      置于引导类路径之前\n    -Xdiag            显示附加诊断消息\n    -Xnoclassgc        禁用类垃圾收集\n    -Xincgc           启用增量垃圾收集\n    -Xloggc:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("file"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("    将 GC 状态记录在文件中（带时间戳）\n    -Xbatch           禁用后台编译\n    -Xms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        设置初始 Java 堆大小\n    -Xmx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        设置最大 Java 堆大小\n    -Xss"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        设置 Java 线程堆栈大小\n    -Xprof            输出 cpu 分析数据\n    -Xfuture          启用最严格的检查，预计会成为将来的默认值\n    -Xrs              减少 Java/VM 对操作系统信号的使用（请参阅文档）\n    -Xcheck:jni       对 JNI 函数执行其他检查\n    -Xshare:off       不尝试使用共享类数据\n    -Xshare:auto      在可能的情况下使用共享类数据（默认）\n    -Xshare:on        要求使用共享类数据，否则将失败。\n    -XshowSettings    显示所有设置并继续\n    -XshowSettings:system\n                      （仅限 Linux）显示系统或容器\n                      配置并继续\n    -XshowSettings:all\n                      显示所有设置并继续\n    -XshowSettings:vm 显示所有与 vm 相关的设置并继续\n    -XshowSettings:properties\n                      显示所有属性设置并继续\n    -XshowSettings:locale\n                      显示所有与区域设置相关的设置并继续\n\n-X 选项是非标准选项。如有更改，恕不另行通知。\n")])])]),a("h2",{attrs:{id:"堆栈相关参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#堆栈相关参数"}},[t._v("#")]),t._v(" 堆栈相关参数")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-Xms")])])]),t._v(" "),a("p",[t._v("堆最小值")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-Xmx")])])]),t._v(" "),a("p",[t._v("堆最大堆值。-Xms与-Xmx 的单位默认字节都是以k、m做单位的。")]),t._v(" "),a("p",[t._v("通常这两个配置参数相等，避免每次空间不足，动态扩容带来的影响。")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-Xss")])])]),t._v(" "),a("p",[t._v("每个线程池的"),a("strong",[t._v("堆栈大小")]),t._v("。在jdk5以上的版本，每个线程堆栈大小为1m，jdk5以前的版本是每个线程池大小为256k。一般在相同物理内存下，如果减少－xss值会产生更大的线程数，但不同的操作系统对进程内线程数是有限制的，是不能无限生成。")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-Xmn")])])]),t._v(" "),a("p",[a("strong",[t._v("新生代大小")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-XX:NewRatio")])])]),t._v(" "),a("p",[t._v("设置新生代与老年代比值，-XX:NewRatio=4 表示新生代与老年代所占比例为1:4 ，新生代占比整个堆的五分之一。如果设置了-Xmn的情况下，该参数是不需要在设置的。")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-XX:PermSize")])])]),t._v(" "),a("p",[t._v("设置永久代初始值，默认是物理内存的六十四分之一")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-XX:MaxPermSize")])])]),t._v(" "),a("p",[t._v("设置永久代最大值，默认是物理内存的四分之一")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-XX:MaxTenuringThreshold")])])]),t._v(" "),a("p",[t._v("新生代中对象存活次数，默认15。(若对象在eden区，经历一次MinorGC后还活着，则被移动到Survior区，年龄加1。以后，对象每次经历MinorGC，年龄都加1。达到阀值，则移入老年代)")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-XX:SurvivorRatio")])])]),t._v(" "),a("p",[t._v("Eden区与Subrvivor区大小的比值，如果设置为8，两个Subrvivor区与一个Eden区的比值为2:8，一个Survivor区占整个新生代的十分之一")]),t._v(" "),a("ul",[a("li",[t._v("-XX:+UseFastAccessorMethods")])]),t._v(" "),a("p",[t._v("原始类型快速优化")]),t._v(" "),a("ul",[a("li",[t._v("-XX:+AggressiveOpts")])]),t._v(" "),a("p",[t._v("编译速度加快")]),t._v(" "),a("ul",[a("li",[t._v("-XX:PretenureSizeThreshold")])]),t._v(" "),a("p",[t._v("对象超过多大值时直接在老年代中分配")]),t._v(" "),a("h2",{attrs:{id:"垃圾回收器的jvm参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收器的jvm参数"}},[t._v("#")]),t._v(" 垃圾回收器的JVM参数")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-XX:+UseSerialGC")])])]),t._v(" "),a("p",[t._v("串行垃圾回收，现在基本很少使用。")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-XX:+UseParNewGC")])])]),t._v(" "),a("p",[t._v("新生代使用并行，老年代使用串行；")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-XX:+UseConcMarkSweepGC")])])]),t._v(" "),a("p",[t._v("新生代使用并行，老年代使用CMS(一般都是使用这种方式)，CMS是Concurrent Mark Sweep的缩写，并发标记清除，一看就是老年代的算法，所以，它可以作为老年代的垃圾回收器。CMS不是独占式的，它关注停顿时间")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-XX:ParallelGCThreads")])])]),t._v(" "),a("p",[t._v("指定并行的垃圾回收线程的数量，最好等于CPU数量")]),t._v(" "),a("ul",[a("li",[t._v("-XX:+DisableExplicitGC")])]),t._v(" "),a("p",[t._v("禁用System.gc()，因为它会触发Full GC，这是很浪费性能的，JVM会在需要GC的时候自己触发GC。")]),t._v(" "),a("ul",[a("li",[t._v("-XX:CMSFullGCsBeforeCompaction")])]),t._v(" "),a("p",[t._v("在多少次GC后进行内存压缩，这个是因为并行收集器不对内存空间进行压缩的，所以运行一段时间后会产生很多碎片，使得运行效率降低。")]),t._v(" "),a("ul",[a("li",[t._v("-XX:+CMSParallelRemarkEnabled")])]),t._v(" "),a("p",[t._v("降低标记停顿")]),t._v(" "),a("ul",[a("li",[t._v("-XX:+UseCMSCompactAtFullCollection")])]),t._v(" "),a("p",[t._v("在每一次Full GC时对老年代区域碎片整理，因为CMS是不会移动内存的，因此会非常容易出现碎片导致内存不够用的")]),t._v(" "),a("ul",[a("li",[t._v("-XX:+UseCmsInitiatingOccupancyOnly")])]),t._v(" "),a("p",[t._v("使用手动触发或者自定义触发cms 收集，同时也会禁止hostspot 自行触发CMS GC")]),t._v(" "),a("ul",[a("li",[t._v("-XX:CMSInitiatingOccupancyFraction")])]),t._v(" "),a("p",[t._v("使用CMS作为垃圾回收，使用70%后开始CMS收集")]),t._v(" "),a("ul",[a("li",[t._v("-XX:CMSInitiatingPermOccupancyFraction")])]),t._v(" "),a("p",[t._v("设置perm gen使用达到多少％比时触发垃圾回收，默认是92%")]),t._v(" "),a("ul",[a("li",[t._v("-XX:+CMSIncrementalMode")])]),t._v(" "),a("p",[t._v("设置为增量模式")]),t._v(" "),a("ul",[a("li",[t._v("-XX:+CmsClassUnloadingEnabled")])]),t._v(" "),a("p",[t._v("CMS是不会默认对永久代进行垃圾回收的，设置此参数则是开启")]),t._v(" "),a("ul",[a("li",[t._v("-XX:+PrintGCDetails")])]),t._v(" "),a("p",[t._v("开启详细GC日志模式，日志的格式是和所使用的算法有关")]),t._v(" "),a("ul",[a("li",[t._v("-XX:+PrintGCDateStamps")])]),t._v(" "),a("p",[t._v("将时间和日期也加入到GC日志中")]),t._v(" "),a("h2",{attrs:{id:"jvm调优"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jvm调优"}},[t._v("#")]),t._v(" JVM调优")]),t._v(" "),a("h3",{attrs:{id:"jvm调优有哪些工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jvm调优有哪些工具"}},[t._v("#")]),t._v(" JVM调优有哪些工具？")]),t._v(" "),a("h4",{attrs:{id:"jstat-jvm状态信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jstat-jvm状态信息"}},[t._v("#")]),t._v(" jstat-jvm状态信息")]),t._v(" "),a("p",[t._v("jstat可以打印出当前JVM运行的各种状态信息，例如新生代内存使用情况，老年代内存使用情况，以及垃圾回收的时间。Minor GC发生总次数，总耗时，Full GC发生总次数，总耗时。(jmap -heap命令也可以打印出堆中各个分区的内存使用情况，但是不能定时监测，持续打印。例如每1s打印当前的堆中各个分区的内存使用情况，一直打印100次。)")]),t._v(" "),a("div",{staticClass:"language-plain extra-class"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[t._v("//5828是java进程id，1000是打印间隔，每1000毫秒打印一次，100是总共打印100次\njstat -gc 5828 1000 100\n")])])]),a("p",[t._v("打印结果如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231636997.png",alt:"img"}})]),t._v(" "),a("p",[t._v("各个参数的含义如下：")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("S0C")]),t._v(" 新生代中第一个survivor（幸存区）的总容量 (字节)")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("S1C")]),t._v("新生代中第二个survivor（幸存区）的总容量 (字节)")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("S0U")]),t._v(" 新生代中第一个survivor（幸存区）目前已使用空间 (字节)")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("S1U")]),t._v(" 新生代中第二个survivor（幸存区）目前已使用空间 (字节)")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("EC")]),t._v(" 新生代中Eden区的总容量 (字节)")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("EU")]),t._v(" 新生代中Eden区目前已使用空间 (字节)")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("OC")]),t._v(" 老年代的总容量 (字节)")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("OU")]),t._v(" 老年代代目前已使用空间 (字节)")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("YGC")]),t._v(" 目前新生代垃圾回收总次数")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("YGCT")]),t._v(" 目前新生代垃圾回收总消耗时间")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("FGC")]),t._v(" 目前full gc次数总次数")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("FGCT")]),t._v(" 目前full gc次数总耗时，单位是秒")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("GCT")]),t._v(" 垃圾回收总耗时")])])]),t._v(" "),a("p",[t._v("一般还可以使用"),a("code",[t._v("jstat -gcutil \\<pid>")]),t._v(":统计gc信息，这样打印出来的结果是百分比，而不是实际使用的空间，例如jstat -gcutil 1 1000 100")]),t._v(" "),a("p",[t._v("例如，S0代表 新生代中第一个survivor区的空间使用了73.19%，E代表新生代Eden区使用了51%，O代表老年代食堂了98%")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231636652.png",alt:"img"}})]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("S0")]),t._v(" "),a("td",[t._v("年轻代中第一个survivor（幸存区）已使用的占当前容量百分比")])]),t._v(" "),a("tr",[a("td",[t._v("s1")]),t._v(" "),a("td",[t._v("年轻代中第二个survivor（幸存区）已使用的占当前容量百分比")])]),t._v(" "),a("tr",[a("td",[t._v("E")]),t._v(" "),a("td",[t._v("年轻代中Eden已使用的占当前容量百分比")])]),t._v(" "),a("tr",[a("td",[t._v("O")]),t._v(" "),a("td",[t._v("old代已使用的占当前容量百分比")])]),t._v(" "),a("tr",[a("td",[t._v("M")]),t._v(" "),a("td",[t._v("元空间(MetaspaceSize)已使用的占当前容量百分比")])]),t._v(" "),a("tr",[a("td",[t._v("CCS")]),t._v(" "),a("td",[t._v("压缩使用比例")])]),t._v(" "),a("tr",[a("td",[t._v("YGC")]),t._v(" "),a("td",[t._v("年轻代垃圾回收次数")])]),t._v(" "),a("tr",[a("td",[t._v("FGC")]),t._v(" "),a("td",[t._v("老年代垃圾回收次数")])]),t._v(" "),a("tr",[a("td",[t._v("FGCT")]),t._v(" "),a("td",[t._v("老年代垃圾回收消耗时间")])]),t._v(" "),a("tr",[a("td",[t._v("GCT")]),t._v(" "),a("td",[t._v("垃圾回收消耗总时间")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231637292.png",alt:"img"}})]),t._v(" "),a("h4",{attrs:{id:"jstack-jvm的线程快照"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jstack-jvm的线程快照"}},[t._v("#")]),t._v(" jstack-jvm的线程快照")]),t._v(" "),a("p",[t._v("jstack可以生成当前JVM的线程快照，也就是当前每个线程当前的状态及正在执行的方法，锁相关的信息。"),a("code",[t._v("jstack -l 进程id")]),t._v("，-l代表除了堆栈信息外，还会打印锁的附加信息。jstack还会检测出死锁信息。一般可以用于定位线程长时间停顿，线程间死锁等问题。")]),t._v(" "),a("p",[t._v("例如在下面的例子中，第一个线程获取到lock1，再去获取lock2，第二个线程先获取到lock2，然后再去获取lock1。每个线程都只获得了一个锁，同时在获取另外一个锁，就会进入死锁状态。")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" lock1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v("  lock2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutorService")]),t._v(" executorService "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("newCachedThreadPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        executorService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"线程1获得了lock1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"线程1休眠结束"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"线程1开始尝试获取lock2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"线程1获得了lock2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        executorService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"线程2获得了lock2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"线程2开始尝试获取lock1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"线程2获得了lock2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("使用"),a("code",[t._v("jstack -l 进程id")]),t._v("就可以打印出当前的线程信息")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231637860.png",alt:"img"}})]),t._v(" "),a("p",[t._v("以及各个线程的状态，执行的方法（pool-1-thread-1和pool-1-thread-2分别代表线程池的第一个线程和第二个线程）：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231637521.png",alt:"img"}})]),t._v(" "),a("h4",{attrs:{id:"jmap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmap"}},[t._v("#")]),t._v(" jmap")]),t._v(" "),a("h5",{attrs:{id:"jmap-heap-堆栈快照"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmap-heap-堆栈快照"}},[t._v("#")]),t._v(" jmap -heap-堆栈快照")]),t._v(" "),a("p",[t._v("这个命令可以生成当前堆栈快照。使用 "),a("code",[t._v("jmap -heap 进程id")]),t._v("可以打印出当前堆各分区内存使用情况的情况，新生代(Eden区,To Survivor区,From Survivor区)，老年代区的内存使用情况。")]),t._v(" "),a("p",[t._v("使用jmap -heap查看内存使用情况的案例")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231637816.png",alt:"img"}})]),t._v(" "),a("h5",{attrs:{id:"jmap-histo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmap-histo"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"#/docs/JavaJVM?id=jmap-histo"}},[t._v("jmap -histo")])]),t._v(" "),a("p",[a("strong",[t._v("jmap -histo 进程id")]),t._v(" 打印出当前堆中的对象统计信息，包括类名，每个类的实例数量，总占用内存大小。")]),t._v(" "),a("div",{staticClass:"language-plain extra-class"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[t._v("instances列：表示当前类有多少个实例。\nbytes列：说明当前类的实例总共占用了多少个字节\nclass name列：表示的就是当前类的名称，class name 对于基本数据类型，使用的是缩写。解读：B代表byte ，C代表char ，D代表double， F代表float，I代表int，J代表long，Z代表boolean \n前边有[代表数组，[I 就相当于int[] \n对象数组用`[L+类名`表示\n")])])]),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231636692.png",alt:"img"}})]),t._v(" "),a("h5",{attrs:{id:"jmap-dump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmap-dump"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"#/docs/JavaJVM?id=jmap-dump"}},[t._v("jmap -dump")])]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("jmap -dump:format=b,file=dump.hprof 进程id")]),t._v("可以生成当前的堆栈快照，堆快照和对象统计信息，对生成的堆快照进行分析，可以分析堆中对象所占用内存的情况，检查大对象等。执行"),a("code",[t._v("jvisualvm")]),t._v("命令打开使用Java自带的工具"),a("strong",[t._v("Java VisualVM")]),t._v("来打开堆栈快照文件，进行分析。可以用于排查内存溢出，内存泄露问题。在"),a("strong",[t._v("Java VisualVM")]),t._v("里面可以看到每个类的实例对象占用的内存大小，以及持有这个对象的实例所在的类等等信息。")]),t._v(" "),a("p",[t._v("也可以配置启动时的JVM参数，让发送内存溢出时，自动生成堆栈快照文件。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("-XX:+HeapDumpOnOutOfMemoryError\n\n-XX:HeapDumpPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/liuke/jvmlogs/\n")])])]),a("p",[t._v("使用"),a("strong",[t._v("jmap -dump:format=b,file=/存放路径/heapdump.hprof 进程id")]),t._v("就可以得到堆转储文件，然后执行jvisualvm命令就可以打开JDK自带的jvisualvm软件。")]),t._v(" "),a("p",[t._v("例如在这个例子中会造成OOM问题，通过生成heapdump.hprof文件，可以使用jvisualvm查看造成OOM问题的具体代码位置。")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test018")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" arrayList "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test018")]),t._v(" test018 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test018")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Random")]),t._v(" random "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Random")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i \\"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestObject")]),t._v(" testObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            test018"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("arrayList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("testObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestObject")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" placeholder "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Xms20m")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Xmx20m")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("verbose"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("gc "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrintGCDetails")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HeapDumpOnOutOfMemoryError")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("XX"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HeapDumpPath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("存放路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("heapdump"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hprof\n")])])]),a("p",[t._v("造成OOM问题的代码位置：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231636422.png",alt:"img"}})]),t._v(" "),a("p",[t._v("堆内对象列表")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231636729.png",alt:"img"}})]),t._v(" "),a("p",[t._v("占用内存最多的实例对象就是这个placeholder对象")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231636265.png",alt:"img"}})]),t._v(" "),a("h4",{attrs:{id:"mat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mat"}},[t._v("#")]),t._v(" MAT")]),t._v(" "),a("p",[t._v("MAT主要可以用于分析内存泄露，可以查询dump堆转储文件中的对象列表，以及潜在的内存泄露的对象。")]),t._v(" "),a("p",[t._v("通过导入hprof文件，主页会展示潜在的内存泄露问题，比如下面这个例子中")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test018")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" arrayList "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Random")]),t._v(" random "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Random")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i \\"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestObject")]),t._v(" testObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test018")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("arrayList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("testObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestObject")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" placeholder "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在详情页面Shortest Paths To the Accumulation Point表示GC root对象到内存消耗聚集点的最短路径，内存聚集点的意思就是占用了大量内存的对象，也就是可能发生； 内存泄露的对象。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231636870.png",alt:"img"}})]),t._v(" "),a("p",[t._v("然后在主页点击Histogram，进入Histogram页面可以看到对象列表，with incomming references 也就是可以查看所有对这个对象的引用（思路一般优先看占用内存最大对象；其次看数量最多的对象。）。我们这个例子中主要是byte[]数组分配了占用了大量的内存空间，而byte[]主要来自于Test018类的静态变量arrayList的每个TestObject类型的元素的placeholder属性。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231638314.png",alt:"img"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231636751.png",alt:"img"}})]),t._v(" "),a("p",[t._v("同时可以点击 内存快照对比 功能对两个dump文件进行对比，判断两个dump文件生成间隔期间，各个对象的数量变化，以此来判断内存泄露问题。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231636052.jpeg",alt:"img"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://walegarrett-image-1304556108.cos.ap-chengdu.myqcloud.com/markdown_img/202203231636534.jpeg",alt:"img"}})])])}),[],!1,null,null,null);s.default=r.exports}}]);